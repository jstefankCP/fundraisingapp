<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Shop Popcorn | City Pop Fundraising</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <header>
    <h1>Shop Popcorn for Our Fundraiser!</h1>
  </header>

  <section class="fundraiser-details">
    <p><strong>Fundraising Cause:</strong> City Pop Fundraiser for Local Teams</p>
    <p><strong>Organization:</strong> City Pop Fundraising</p>
    <p class="metrics"><strong>Days Left:</strong> 12 days remaining</p>
    <p class="metrics"><strong>Amount Raised:</strong> $2,430 / $5,000 Goal</p>
  </section>

  <!-- Shopify Collection Component -->
  <div id='collection-component-1761423819822'></div>

  <footer>
    Â© 2025 City Pop Fundraising. All rights reserved.
  </footer>

  <script type="text/javascript">
    // Get fundraiser parameters from URL
    const urlParams = new URLSearchParams(window.location.search);
    const fundraiserId = urlParams.get('fundraiser_id');
    const organizationId = urlParams.get('organization_id');
    const userId = urlParams.get('user_id');

    (function () {
      const scriptURL = 'https://sdks.shopifycdn.com/buy-button/latest/buy-button-storefront.min.js';

      if (window.ShopifyBuy) {
        if (window.ShopifyBuy.UI) {
          ShopifyBuyInit();
        } else {
          loadScript();
        }
      } else {
        loadScript();
      }

      function loadScript() {
        const script = document.createElement('script');
        script.async = true;
        script.src = scriptURL;
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(script);
        script.onload = ShopifyBuyInit;
      }

      function ShopifyBuyInit() {
        const client = ShopifyBuy.buildClient({
          domain: 'city-pop-fundraising.myshopify.com',
          storefrontAccessToken: 'd18a70960882c060cc472257ab67a4d3',
        });

        ShopifyBuy.UI.onReady(client).then(function (ui) {
          ui.createComponent('collection', {
            id: '456057717025',
            node: document.getElementById('collection-component-1761423819822'),
            moneyFormat: '%24%7B%7Bamount%7D%7D',
            options: {
              product: {
                text: { button: "Add to cart" },
                styles: {
                  button: {
                    "background-color": "#0567e8",
                    ":hover": { "background-color": "#055dd1" },
                    ":focus": { "background-color": "#055dd1" },
                    "border-radius": "25px"
                  }
                }
              },
              cart: {
                popup: false,
                startOpen: false,
                styles: {
                  button: {
                    "background-color": "#0567e8",
                    ":hover": { "background-color": "#055dd1" },
                    ":focus": { "background-color": "#055dd1" },
                    "border-radius": "25px"
                  }
                },
                text: { total: "Subtotal", button: "Checkout" },
                // OVERRIDE checkout click
                checkoutRedirect: function(cart) {
                  const baseCheckoutUrl = cart.checkoutUrl; // Shopify-generated URL
                  const fullUrl = baseCheckoutUrl + 
                    `&attributes[fundraiser_id]=${fundraiserId}` +
                    `&attributes[organization_id]=${organizationId}` +
                    `&attributes[CityPopApp]=true` +
                    `&attributes[user_id]=${userId}`;
                  window.location.href = fullUrl;
                }
              }
            }
          });
        });
      }
    })();
  </script>
</body>
</html>

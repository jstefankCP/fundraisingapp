<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>City Pop Fundraiser</title>
<style>
body { font-family: sans-serif; background-color: #f9f9f9; color: #333; margin:0; padding:1rem; }
h1 { color: #0567e8; text-align:center; margin-bottom:2rem; }

/* Fundraiser Header */
#fundraiser-header { background:#0567e8; color:#fff; padding:1.5rem 2rem; border-radius:10px; margin-bottom:2rem; text-align:center; }
#fundraiser-header div { margin-bottom:0.3rem; }
#fundraiser-cause { font-size:1.2rem; font-weight:600; }
#org-id-display, #user-id-display, #end-date-display { font-size:1rem; font-weight:500; }
#progress-bar-container { background:#fff; border-radius:20px; overflow:hidden; height:20px; max-width:400px; margin:0.5rem auto; }
#progress-bar { height:100%; width:0%; background:#66cbed; text-align:right; color:#fff; line-height:20px; font-size:0.8rem; padding-right:5px; border-radius:20px; }

/* Product grid */
.product-grid { display:flex; flex-wrap:wrap; gap:20px; justify-content:center; }
.product-item { background:#fff; border-radius:10px; padding:1rem; flex:1 1 250px; max-width:250px; box-shadow:0 2px 6px rgba(0,0,0,0.1); display:flex; flex-direction:column; align-items:center; }
.product-item img { width:100%; height:auto; border-radius:10px; }
.product-title { font-weight:600; margin:0.5rem 0; text-align:center; }
.product-price { font-weight:bold; margin-bottom:0.5rem; color:#0567e8; }
.nutrition-link { font-size:0.9rem; color:#66cbed; text-decoration:underline; margin-bottom:0.5rem; cursor:pointer; }
.quantity-selector { display:flex; align-items:center; justify-content:center; margin-bottom:0.5rem; }
.quantity-selector button { background:#0567e8; color:#fff; border:none; padding:0.2rem 0.6rem; cursor:pointer; border-radius:5px; margin:0 0.3rem; font-size:1rem; }
.quantity-selector span { width:30px; text-align:center; font-weight:bold; }
.add-to-cart-btn { background-color:#0567e8; color:#fff; border:none; padding:0.6rem 1.2rem; border-radius:25px; cursor:pointer; font-size:1rem; width:100%; margin-top:0.3rem; }
.add-to-cart-btn:hover { background-color:#055dd1; }

/* Slide out cart */
#cart-slideout { position:fixed; top:0; right:-100%; width:320px; height:100%; background:#fff; box-shadow:-2px 0 6px rgba(0,0,0,0.2); transition:right 0.3s ease; padding:1rem; overflow-y:auto; z-index:1000; display:flex; flex-direction:column; }
#cart-slideout h2 { margin-top:0; color:#0567e8; }
#cart-slideout .continue-shopping { background:transparent; border:none; color:#0567e8; cursor:pointer; margin-bottom:1rem; font-size:0.95rem; text-align:left; }
.cart-item { display:flex; align-items:center; justify-content:space-between; margin-bottom:0.5rem; border-bottom:1px solid #eee; padding-bottom:0.3rem; }
.cart-item img { width:40px; height:40px; border-radius:5px; margin-right:0.5rem; }
.cart-item-title { flex:1; font-size:0.9rem; margin-right:0.5rem; }
.cart-item-controls { display:flex; align-items:center; gap:0.3rem; }
.cart-item-controls button { background:#0567e8; color:#fff; border:none; padding:0.2rem 0.6rem; cursor:pointer; border-radius:5px; }
.trash-btn { background: none; border: none; color: #aaa; font-size: 1rem; cursor: pointer; padding: 0; line-height: 1; }
.trash-btn:hover { color: #555; }
#subtotal { font-weight:bold; margin:1rem 0; text-align:right; color:#0567e8; }
.checkout-btn { background:#0567e8; color:#fff; border:none; padding:0.6rem 1.2rem; border-radius:25px; width:100%; cursor:pointer; font-size:1rem; }
.checkout-btn:hover { background:#055dd1; }
#cart-overlay { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.3); z-index:999; }

/* Floating Cart Button (mobile only) */
#floating-cart-btn { position: fixed; bottom: 20px; right: 20px; background-color: #66cbed; color: #fff; border: none; border-radius: 50%; width: 60px; height: 60px; font-size: 1.5rem; box-shadow: 0 4px 10px rgba(0,0,0,0.2); display: none; align-items: center; justify-content: center; cursor: pointer; z-index: 1100; }
#floating-cart-btn .cart-count { position: absolute; top: 8px; right: 8px; background: #ff5a5f; color: #fff; border-radius: 50%; width: 20px; height: 20px; font-size: 0.8rem; font-weight: bold; display: flex; align-items: center; justify-content: center; }
@media (max-width: 768px) {
#floating-cart-btn { display: flex; }
.product-grid { flex-direction: column; align-items: center; }
.product-item { max-width: 100%; }
}

/* Footer link styling */
.footer-link { background:none; border:none; color:#fff; text-decoration:underline; cursor:pointer; font-size:0.9rem; }
.footer-link:hover { color:#cce6ff; }

/* Modern Fundraiser Header */
#fundraiser-header {
background: linear-gradient(135deg, #0567e8, #66cbed);
color: #fff;
padding: 2rem 2.5rem;
border-radius: 20px;
margin-bottom: 2rem;
text-align: center;
box-shadow: 0 8px 20px rgba(0,0,0,0.15);
transition: transform 0.3s;
}
#fundraiser-header:hover {
transform: translateY(-2px);
}
#fundraiser-cause {
font-size: 1.8rem;
font-weight: 700;
margin-bottom: 0.5rem;
text-shadow: 1px 1px 3px rgba(0,0,0,0.3);
}
#org-id-display, #user-id-display, #end-date-display {
font-size: 1rem;
font-weight: 500;
margin-bottom: 0.3rem;
opacity: 0.85;
}

#progress-bar-container {
background: rgba(255,255,255,0.2);
border-radius: 50px;
overflow: hidden;
height: 25px;
max-width: 450px;
margin: 1rem auto;
box-shadow: inset 0 2px 5px rgba(0,0,0,0.1);
}
#progress-bar {
height: 100%;
width: 0%;
background: linear-gradient(90deg, #ffdd00, #ff7a00);
text-align: right;
line-height: 25px;
font-weight: 600;
padding-right: 10px;
color: #333;
border-radius: 50px;
transition: width 1s ease-in-out;
box-shadow: 0 2px 6px rgba(0,0,0,0.2);
}

.fundraiser-stats {
font-size: 0.95rem;
font-weight: 500;
margin-top: 0.5rem;
opacity: 0.9;
}
.fundraiser-stats span {
font-weight: 700;
}

/* Profile Photo Styling */
#user-profile-photo-container {
position: relative;
width: 100%;
display: flex;
justify-content: center;
margin-top: -60px; /* makes it overlap the header */
margin-bottom: 20px; /* space below the profile photo */
}

#user-profile-photo {
width: 120px;
height: 120px;
border-radius: 50%;
object-fit: cover;
border: 4px solid #fff;
box-shadow: 0 4px 12px rgba(0,0,0,0.2);
background: #e0e0e0 url('https://cdn-icons-png.flaticon.com/512/847/847969.png') center/50% no-repeat;
}

/* Product Tabs */
#product-tabs {
display: flex;
justify-content: center;
flex-wrap: wrap;
gap: 10px;
margin-bottom: 2rem;
}

#product-tabs .tab {
background: #fff;
border: 2px solid #0567e8;
color: #0567e8;
padding: 0.5rem 1rem;
border-radius: 20px;
cursor: pointer;
font-weight: 600;
transition: all 0.2s ease;
}

#product-tabs .tab:hover {
background: #66cbed;
color: #fff;
border-color: #66cbed;
}

#product-tabs .tab.active {
background: #0567e8;
color: #fff;
}

#product-tabs {
  position: sticky;    /* Makes it sticky */
  top: 0;              /* Sticks to the top of viewport */
  background-color: #fff; /* Ensures tabs have a background */
  z-index: 1000;       /* Keeps it above content */
  padding: 0.5rem 0;   /* Optional: spacing inside tabs */
  border-bottom: 1px solid #ccc; /* Optional: nice separator */
}

</style>

<!-- Supabase CDN -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>

<!-- Fundraiser Header -->
<div id="fundraiser-header">
<div id="fundraiser-cause">Loading fundraiser...</div>
<div id="org-id-display"> </div>
<div id="user-id-display"> </div>
<div id="end-date-display"> </div>

<div id="progress-bar-container">
<div id="progress-bar"></div>
</div>

<div class="fundraiser-stats">
<span id="raised-amount">$0</span> raised of <span id="goal-amount">$1000</span>
</div>
</div>

<!-- Profile Photo -->
<div id="user-profile-photo-container">
<img id="user-profile-photo" src="https://cdn-icons-png.flaticon.com/512/847/847969.png" alt="User Profile Photo">
</div>

<div class="site-wide-message" style="padding:1rem; background:#f8d210; text-align:center; font-weight:bold; font-size:1.1rem;">
  Snack Big, Give Bigger! 50% of every order goes directly back to support!
</div>

<!-- Product Line Tabs -->
<div id="product-tabs">
<button class="tab active" data-category="Popcorn">Popcorn</button>
<button class="tab" data-category="Seasoned Pretzels">Seasoned Pretzels</button>
<button class="tab" data-category="Soft-Baked Pretzels">Soft-Baked Pretzels</button>
<button class="tab" data-category="Cotton Candy">Cotton Candy</button>
</div>

<div class="product-grid" id="product-grid"></div>

<div id="fundraiser-ended-message" style="
 display:none; 
 text-align:center; 
 font-size:1.6rem; 
 font-weight:700; 
 line-height:1.5; 
 padding:3rem 1rem; 
 color:#0567e8; 
 background: rgba(102, 203, 237, 0.1); 
 border-radius:15px;
 box-shadow: 0 4px 10px rgba(0,0,0,0.1);
">
Although this fundraiser has closed, your support hasn‚Äôt gone unnoticed. 
We‚Äôre grateful for your enthusiasm and can‚Äôt wait to give you another opportunity 
to make an impact in upcoming campaigns!
</div>

<!-- Slide-out cart -->
<div id="cart-overlay"></div>
<div id="cart-slideout">
<button class="continue-shopping" onclick="closeCart()">‚Üê Continue Shopping</button>
<h2>Your Cart</h2>
<div id="cart-items"></div>
<div id="subtotal">Subtotal: $0</div>
<button id="checkout-btn" class="checkout-btn">Secure Checkout</button>
</div>

<!-- Floating Cart Button -->
<button id="floating-cart-btn" onclick="openCart()">
üõí
<span class="cart-count" id="cart-count">0</span>
</button>

<script>
/* --- Supabase Initialization --- */
const SUPABASE_URL = 'https://krjdhmpxojascmkimfru.supabase.co';
const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImtyamRobXB4b2phc2Nta2ltZnJ1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTgwMzU0MTEsImV4cCI6MjA3MzYxMTQxMX0.DoT40NSvuNZ2_HjwNfhA2qaxmWNXA57Isf1jK43TQP8';
const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

/* --- Fundraiser Params --- */
function getFundraiserParams() {
const params = {};
const urlParams = new URLSearchParams(window.location.search);
['fundraiser_id', 'organization_id', 'user_id'].forEach(key => {
const value = urlParams.get(key);
if (value) params[key] = value;
});
return params;
}
const fundraiserParams = getFundraiserParams();

/* --- DOM Elements --- */
const fundraiserCauseEl = document.getElementById("fundraiser-cause");
const orgIdDisplay = document.getElementById("org-id-display");
const userIdDisplay = document.getElementById("user-id-display");
const progressBar = document.getElementById("progress-bar");
const raisedEl = document.getElementById("raised-amount");
const goalEl = document.getElementById("goal-amount");
const endDateEl = document.getElementById("end-date-display");

let fundraiserEndDate = null;

/* --- Fetch Fundraiser Info --- */
async function fetchFundraiserInfo() {
if (!fundraiserParams.fundraiser_id) return;

const { data: fundraiser, error } = await supabaseClient
.from('fundraisers')
.select('name, goal_amount, end_date')
.eq('id', fundraiserParams.fundraiser_id)
.single();

if (error) { console.error(error); return; }

fundraiserCauseEl.textContent = fundraiser.name;

const formattedGoal = Number(fundraiser.goal_amount || 0).toLocaleString('en-US', {
style: 'currency',
currency: 'USD',
minimumFractionDigits: 2,
maximumFractionDigits: 2
});
goalEl.textContent = formattedGoal;

fundraiserEndDate = fundraiser.end_date;
updateCountdown();
setInterval(updateCountdown, 1000 * 60); // update every minute
// endDateEl.textContent = "ends on " + fundraiser.end_date;

// Fetch the total raised from fundraiser_orders
const { data: orders, error: ordersError } = await supabaseClient
.from('fundraiser_orders')
.select('commission_amount')
.eq('fundraiser_id', fundraiserParams.fundraiser_id);

if (ordersError) { console.error(ordersError); return; }

const totalRaised = orders.reduce((sum, o) => sum + Number(o.commission_amount || 0), 0);

// Update progress bar
const percent = fundraiser.goal_amount ? Math.min((totalRaised / fundraiser.goal_amount) * 100, 100) : 0;
progressBar.style.width = percent + '%';
progressBar.textContent = Number(totalRaised).toLocaleString('en-US', {
style: 'currency',
currency: 'USD',
minimumFractionDigits: 2,
maximumFractionDigits: 2
});
raisedEl.textContent = progressBar.textContent;
}


/* --- Fetch Organization --- */
async function fetchOrganizationName(orgId) {
if (!orgId) return;
const { data: org, error } = await supabaseClient
.from('organizations')
.select('name')
.eq('id', orgId)
.single();
if (error) { console.error(error); return; }
orgIdDisplay.textContent = org.name;
}

/* --- Fetch User --- */
async function fetchUserName(userId) {
  if (!userId) return;
  
  const { data: user, error } = await supabaseClient
    .from('user_profiles')
    .select('first_name, last_name, profile_photo_url')
    .eq('id', userId)
    .single();

  if (error) { console.error(error); return; }

  document.getElementById("user-id-display").textContent =
    "supporting " + user.first_name + " " + user.last_name;

  const photoContainer = document.getElementById("user-profile-photo-container");
  photoContainer.innerHTML = ""; // clear any default

  if (user && user.profile_photo_url) {
    // Display emoji as text
    const emojiEl = document.createElement("div");
    emojiEl.textContent = user.profile_photo_url; // the emoji from DB
    emojiEl.style.fontSize = "80px"; // adjust size
    emojiEl.style.lineHeight = "120px";
    emojiEl.style.textAlign = "center";
    emojiEl.style.width = "120px";
    emojiEl.style.height = "120px";
    emojiEl.style.borderRadius = "50%";
    emojiEl.style.border = "4px solid #fff";
    emojiEl.style.boxShadow = "0 4px 12px rgba(0,0,0,0.2)";
    emojiEl.style.background = "#e0e0e0";
    photoContainer.appendChild(emojiEl);
  } else {
    // fallback silhouette
    const img = document.createElement("img");
    img.src = "https://cdn-icons-png.flaticon.com/512/847/847969.png";
    img.alt = "User Profile Photo";
    img.id = "user-profile-photo";
    photoContainer.appendChild(img);
  }
}

/* --- Fetch Total Raised --- */
async function fetchTotalRaised() {
if (!fundraiserParams.fundraiser_id) return;

const { data, error } = await supabaseClient
.from('fundraiser_orders')
.select('commission_amount')
.eq('fundraiser_id', fundraiserParams.fundraiser_id);

if (error) {
console.error("Error fetching fundraiser total:", error);
return;
}

// Sum up all commission_amount values
const totalRaised = data.reduce((sum, order) => sum + (order.commission_amount || 0), 0);

// Format as USD
const formattedTotal = `$${totalRaised.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
raisedEl.textContent = formattedTotal;

// Update progress bar
const goal = parseFloat(goalEl.textContent.replace(/\$|,/g, "")) || 0;
const percent = goal > 0 ? Math.min((totalRaised / goal) * 100, 100) : 0;
progressBar.style.width = `${percent}%`;
progressBar.textContent = `${percent.toFixed(0)}%`;
}

/* --- Trigger Fetch --- */
fetchFundraiserInfo();
fetchOrganizationName(fundraiserParams.organization_id);
fetchUserName(fundraiserParams.user_id);
fetchTotalRaised();

/* --- Countdown Timer (Days, Hours, Minutes Left) --- */
function updateCountdown() {
  if (!fundraiserEndDate) return;

  // Parse the YYYY-MM-DD date and set time to end of day (23:59:59)
  const [year, month, day] = fundraiserEndDate.split("-").map(Number);
  const endDate = new Date(year, month - 1, day, 23, 59, 59); // local time

  if (isNaN(endDate.getTime())) {
    console.error("Invalid end date:", fundraiserEndDate);
    endDateEl.textContent = "Date unavailable";
    return;
  }

  // Current time
  const now = new Date();

  // Difference in milliseconds
  const diffMs = endDate.getTime() - now.getTime();

  const productGrid = document.getElementById("product-grid");
  const floatingCartBtn = document.getElementById("floating-cart-btn");
  const endedMessage = document.getElementById("fundraiser-ended-message");

  if (diffMs <= 0) {
    // Fundraiser ended
    endDateEl.textContent = "This Fundraiser Has Ended";
    if (productGrid) productGrid.style.display = "none";
    if (floatingCartBtn) floatingCartBtn.style.display = "none";
    if (endedMessage) endedMessage.style.display = "block";
    return;
  }

  // Calculate days, hours, minutes left
  const totalMinutes = Math.floor(diffMs / (1000 * 60));
  const days = Math.floor(totalMinutes / (60 * 24));
  const hours = Math.floor((totalMinutes % (60 * 24)) / 60);
  const minutes = totalMinutes % 60;

  // Build display string
  let display = "This fundraiser ends in: ";
  if (days > 0) display += `${days} day${days !== 1 ? "s" : ""} `;
  if (hours > 0 || days > 0) display += `${hours} hr${hours !== 1 ? "s" : ""} `;
  display += `${minutes} min${minutes !== 1 ? "s" : ""}`;

  endDateEl.textContent = display;

  // Ensure product grid and floating cart are visible
  if (productGrid) productGrid.style.display = "flex";
  if (floatingCartBtn) floatingCartBtn.style.display = "flex";
  if (endedMessage) endedMessage.style.display = "none";
}

// Update every minute (or change to 1000 for every second)
setInterval(updateCountdown, 1000 * 60);
updateCountdown();


const shopifyStore = "city-pop-fundraising.myshopify.com";

const products = [
// --- Popcorn ---
{ title: "Classic Bundle", category: "Popcorn", variantId: "48012301336865", price: 34, img:"https://cdn.shopify.com/s/files/1/0792/2191/5937/files/Classic_Popcorn_Combo.png?v=1706728547" }, 
{ title: "The All Star Line Up", category: "Popcorn", variantId: "51956539490593", price: 59, img:"https://cdn.shopify.com/s/files/1/0792/2191/5937/files/The_All_Star_Line_Up_9192b142-9ece-4dc5-8811-3c9d24ad3b19.png?v=1761705077" },
{ title: "Supreme Combo", category: "Popcorn", variantId: "47907478077729", price: 99, img:"https://cdn.shopify.com/s/files/1/0792/2191/5937/files/Supreme_Combo.png?v=1761705864" },  
{ title: "Cheese & Caramel Mix Popcorn", category: "Popcorn", variantId: "47907478077729", price: 16, img:"https://cdn.shopify.com/s/files/1/0792/2191/5937/products/CheeseCaramel.png?v=1750196665" },
{ title: "White Cheddar Popcorn", category: "Popcorn", variantId: "47949265207585", price: 12, img:"https://cdn.shopify.com/s/files/1/0792/2191/5937/products/WhiteCheddar.png?v=1750196654" },
{ title: "Extra Buttery Popcorn", category: "Popcorn", variantId: "47946797482273", price: 12, img:"https://cdn.shopify.com/s/files/1/0792/2191/5937/products/ExtraButtery.png?v=1750196660" },
{ title: "Caramel Popcorn", category: "Popcorn", variantId: "47907462676769", price: 16, img:"https://cdn.shopify.com/s/files/1/0792/2191/5937/products/Caramel_1_d6b563d0-fcd7-4ac4-9917-3da334dc2e55.png?v=1750196695" },
{ title: "Kettle Popcorn", category: "Popcorn", variantId: "47971562193185", price: 12, img:"https://cdn.shopify.com/s/files/1/0792/2191/5937/products/Kettle.png?v=1750196658" },
{ title: "Jalapeno Cheddar Popcorn", category: "Popcorn", variantId: "47972348264737", price: 12, img:"https://cdn.shopify.com/s/files/1/0792/2191/5937/products/JalapenoCheddar_80ea7902-a107-4113-9dd3-ca2bdb62c1f7.png?v=1750196657" },
{ title: "Cheese Popcorn", category: "Popcorn", variantId: "47907469295905", price: 12, img:"https://cdn.shopify.com/s/files/1/0792/2191/5937/products/Cheese.png?v=1750196644" },
{ title: "Sea Salt & Cracked Pepper Popcorn", category: "Popcorn", variantId: "47941483856161", price: 12, img:"https://cdn.shopify.com/s/files/1/0792/2191/5937/products/SeaSaltNCrackedPepper.png?v=1750196661" },
{ title: "Chocolate Drizzle Popcorn", category: "Popcorn", variantId: "47930741424417", price: 20, img:"https://cdn.shopify.com/s/files/1/0792/2191/5937/products/ChocolateDrizzle.png?v=1750196667" },
{ title: "Low Salt Popcorn", category: "Popcorn", variantId: "47971748217121", price: 12, img:"https://cdn.shopify.com/s/files/1/0792/2191/5937/products/LowSalt.png?v=1750196643" },

// --- Seasoned Pretzels ---
{ title: "Classic Crunch Pack", category: "Seasoned Pretzels", variantId: "51956599095585", price: 46, img:"https://cdn.shopify.com/s/files/1/0792/2191/5937/files/ClassicCrunchPretzelPack.jpg?v=1761687182" },
{ title: "Bold & Savory Bash", category: "Seasoned Pretzels", variantId: "51956598276385", price: 46, img:"https://cdn.shopify.com/s/files/1/0792/2191/5937/files/BoldandSavoryBashPretzelPack.jpg?v=1761687176" },
{ title: "Ultimate Flavor Adventure", category: "Seasoned Pretzels", variantId: "51956613742881", price: 13, img:"https://cdn.shopify.com/s/files/1/0792/2191/5937/files/UltimateFlavorAdventurePretzelPack.jpg?v=1761687209" }, 
{ title: "Bacon Cheddar Pretzel Twists", category: "Seasoned Pretzels", variantId: "51956138836257", price: 13, img:"https://cdn.shopify.com/s/files/1/0792/2191/5937/files/BaconCheddarPretzelTwists.jpg?v=1761687171" },
{ title: "Barbecue Bacon Pretzel Twists", category: "Seasoned Pretzels", variantId: "51956138869025", price: 13, img:"https://cdn.shopify.com/s/files/1/0792/2191/5937/files/BarbecueBaconPretzelTwists.jpg?v=1761687172" },
{ title: "Barbecue Pretzel Twists", category: "Seasoned Pretzels", variantId: "51956138901793", price: 13, img:"https://cdn.shopify.com/s/files/1/0792/2191/5937/files/BarbecuePretzelTwists.jpg?v=1761687174" },
{ title: "Buffalo Ranch Pretzel Twists", category: "Seasoned Pretzels", variantId: "51956138967329", price: 13, img:"https://cdn.shopify.com/s/files/1/0792/2191/5937/files/BuffaloRanchPretzelTwists.jpg?v=1761687178" },
{ title: "Cinnamon Sugar Pretzel Twists", category: "Seasoned Pretzels", variantId: "51956139000097", price: 13, img:"https://cdn.shopify.com/s/files/1/0792/2191/5937/files/CinnamonSugarPretzelTwists.jpg?v=1761687180" },
{ title: "Dill Pickle Pretzel Twists", category: "Seasoned Pretzels", variantId: "51956139098401", price: 13, img:"https://cdn.shopify.com/s/files/1/0792/2191/5937/files/DillPicklePretzelTwists.jpg?v=1761687184" },
{ title: "Everything Bagel Pretzel Twists", category: "Seasoned Pretzels", variantId: "51956140048673", price: 13, img:"https://cdn.shopify.com/s/files/1/0792/2191/5937/files/EverythingBagelPretzelTwists.jpg?v=1761687185" },
{ title: "Garlic Parmesan Pretzel Twists", category: "Seasoned Pretzels", variantId: "51956140081441", price: 13, img:"https://cdn.shopify.com/s/files/1/0792/2191/5937/files/GarlicParmesanPretzelTwists.jpg?v=1761687188" },
{ title: "Honey Butter Pretzel Twists", category: "Seasoned Pretzels", variantId: "51956140114209", price: 13, img:"https://cdn.shopify.com/s/files/1/0792/2191/5937/files/HoneyButterPretzelTwists.jpg?v=1761687190" },
{ title: "Honey Mustard Pretzel Twists", category: "Seasoned Pretzels", variantId: "51956140146977", price: 13, img:"https://cdn.shopify.com/s/files/1/0792/2191/5937/files/HoneyMustardPretzelTwists.jpg?v=1761687192" },
{ title: "Pizza Pretzel Twists", category: "Seasoned Pretzels", variantId: "51956140179745", price: 13, img:"https://cdn.shopify.com/s/files/1/0792/2191/5937/files/PizzaPretzelTwists.jpg?v=1761687194" },
{ title: "Ranch Pretzel Twists", category: "Seasoned Pretzels", variantId: "51956140212513", price: 13, img:"https://cdn.shopify.com/s/files/1/0792/2191/5937/files/RanchPretzelTwists.jpg?v=1761687196" },
{ title: "Simply Salted Pretzel Twists", category: "Seasoned Pretzels", variantId: "51956140245281", price: 13, img:"https://cdn.shopify.com/s/files/1/0792/2191/5937/files/SimplySaltedPretzelTwists.jpg?v=1761687198" },
{ title: "Sour Cream & Cheddar Pretzel Twists", category: "Seasoned Pretzels", variantId: "51956140441889", price: 13, img:"https://cdn.shopify.com/s/files/1/0792/2191/5937/files/SourCream_CheddarPretzelTwists.jpg?v=1761687202" },
{ title: "Sour Cream & Onion Pretzel Twists", category: "Sour Cream & Onion Pretzel Twists", variantId: "51956140507425", price: 13, img:"https://cdn.shopify.com/s/files/1/0792/2191/5937/files/SourCream_OnionPretzelTwists.jpg?v=1761687204" },

// --- Soft-Baked Pretzels ---
{ title: "Pretzel Nuggets Kit", category: "Soft-Baked Pretzels", variantId: "45882496712993", price: 48, img:"https://cdn.shopify.com/s/files/1/0792/2191/5937/files/CP-Pretzels-32.png?v=1690250507" },
{ title: "Pretzel Braids Kit", category: "Soft-Baked Pretzels", variantId: "45882463519009", price: 39, img:"https://cdn.shopify.com/s/files/1/0792/2191/5937/files/CP-Pretzels-36.png?v=1690250658" },
{ title: "Jumbo Pretzel Kit", category: "Soft-Baked Pretzels", variantId: "45882445988129", price: 46, img:"https://cdn.shopify.com/s/files/1/0792/2191/5937/files/CP-Pretzels-48.png?v=1690251194" },
{ title: "Pretzel Twist Kit", category: "Soft-Baked Pretzels", variantId: "45882302824737", price: 44, img:"https://cdn.shopify.com/s/files/1/0792/2191/5937/files/CP-Pretzels-20.png?v=1689991898" },
  
// --- Cotton Candy ---
{ title: "Fun Bubble Cotton Candy", category: "Cotton Candy", variantId: "46021437423905", price: 10, img:"https://cdn.shopify.com/s/files/1/0792/2191/5937/files/Fun_Bubble_CottonCandy_2.png?v=1690998914" },
{ title: "Razzle Dazzle Cotton Candy", category: "Cotton Candy", variantId: "45882691748129", price: 10, img:"https://cdn.shopify.com/s/files/1/0792/2191/5937/products/Razzle_Dazzle_CottonCandy_02.png?v=1689997469" },
{ title: "Unicorn Swirls Cotton Candy", category: "Cotton Candy", variantId: "45882690928929", price: 10, img:"https://cdn.shopify.com/s/files/1/0792/2191/5937/products/Unicorn_Swirls_CottonCandy_2.png?v=1689997463" },
{ title: "Cotton Tail Cotton Candy", category: "Cotton Candy", variantId: "45882690404641", price: 10, img:"https://cdn.shopify.com/s/files/1/0792/2191/5937/products/Cotton_Tail_CottonCandy_2.png?v=1689997458" },
{ title: "Sassy Apple Cotton Candy", category: "Cotton Candy", variantId: "45882690142497", price: 10, img:"https://cdn.shopify.com/s/files/1/0792/2191/5937/products/Sassy_Apple_CottonCandy_2.png?v=1689997454" },
{ title: "Jolly Berry Cotton Candy", category: "Cotton Candy", variantId: "45882690044193", price: 10, img:"https://cdn.shopify.com/s/files/1/0792/2191/5937/products/Jolly_Berry_CottonCandy_2.png?v=1689997451" },
{ title: "Island Oasis Cotton Candy", category: "Cotton Candy", variantId: "45882689749281", price: 10, img:"https://cdn.shopify.com/s/files/1/0792/2191/5937/products/Island_Oasis_CottonCandy_2.png?v=1689997446" },
{ title: "Grapeness Cotton Candy", category: "Cotton Candy", variantId: "45882687652129", price: 10, img:"https://cdn.shopify.com/s/files/1/0792/2191/5937/products/Grapeness_CottonCandy_2.png?v=1689997441" },
{ title: "Wacky Watermelon Cotton Candy", category: "Cotton Candy", variantId: "45882687521057", price: 10, img:"https://cdn.shopify.com/s/files/1/0792/2191/5937/products/Wacky_Watermelon_CottonCandy_2.png?v=1689997438" },
{ title: "Cherry Berry Cotton Candy", category: "Cotton Candy", variantId: "45882686996769", price: 10, img:"https://cdn.shopify.com/s/files/1/0792/2191/5937/products/Cherry_Berry_CottonCandy_2.png?v=1689997433" },
{ title: "Boo Berry Cotton Candy", category: "Cotton Candy", variantId: "45882684277025", price: 10, img:"https://cdn.shopify.com/s/files/1/0792/2191/5937/products/Boo_Berry_CottonCandy_2.png?v=1689997427" },
{ title: "Birthday Bash Cotton Candy", category: "Cotton Candy", variantId: "45882684113185", price: 10, img:"https://cdn.shopify.com/s/files/1/0792/2191/5937/products/Birthday_Bash_CottonCandy_2.png?v=1689997422" },
{ title: "Banana Bonanza Cotton Candy", category: "Cotton Candy", variantId: "45882683949345", price: 10, img:"https://cdn.shopify.com/s/files/1/0792/2191/5937/products/Banana_Bonanza_CottonCandy_2.png?v=1689997418" },
{ title: "Silly Nilly Cotton Candy", category: "Cotton Candy", variantId: "45882683654433", price: 10, img:"https://cdn.shopify.com/s/files/1/0792/2191/5937/products/Silly_Nilly_CottonCandy_2.png?v=1689997413" },

  
// --- Candy ---
{ title: "Gummy Bears", category: "Candy", variantId: "candy1", price: 4, img:"https://cdn.shopify.com/s/files/1/0792/2191/5937/files/gummy-bears.jpg" },
{ title: "Sour Worms", category: "Candy", variantId: "candy2", price: 4, img:"https://cdn.shopify.com/s/files/1/0792/2191/5937/files/sour-worms.jpg" }
];

const cart = {};
const grid = document.getElementById("product-grid");

function renderProducts(category = "Popcorn") {
    grid.innerHTML = "";
    const filtered = products.filter(p => p.category === category);
    filtered.forEach(product => {
        const div = document.createElement("div");
        div.className = "product-item";

        // Product image
        const img = document.createElement("img");
        img.src = product.img;
        div.appendChild(img);

        // Add FedEx 2-Day badge for Soft-Baked Pretzels only
        if (product.category === "Soft-Baked Pretzels") {
            const badge = document.createElement("img");
            badge.src = "https://cdn.shopify.com/s/files/1/0792/2191/5937/files/FedEx_2Day.png?v=1761708551";
            badge.alt = "2-Day Shipping";
            badge.style.width = "60px"; // adjust size as needed
            badge.style.position = "absolute";
            badge.style.top = "10px";
            badge.style.right = "10px";
            badge.style.zIndex = "10";
            div.style.position = "relative"; // needed for absolute positioning
            div.appendChild(badge);
        }

        // Product title
        const title = document.createElement("div");
        title.className = "product-title";
        title.textContent = product.title;
        div.appendChild(title);

        // Price
        const price = document.createElement("div");
        price.className = "product-price";
        price.textContent = `$${product.price}`;
        div.appendChild(price);

        // Nutrition link
        const nutrition = document.createElement("div");
        nutrition.className = "nutrition-link";
        nutrition.textContent = "Additional Details";
        nutrition.addEventListener("click", () => alert("Nutritional info placeholder"));
        div.appendChild(nutrition);

        // Quantity selector
        const qtyDiv = document.createElement("div");
        qtyDiv.className = "quantity-selector";
        const minusBtn = document.createElement("button");
        minusBtn.textContent = "-";
        const qtySpan = document.createElement("span");
        qtySpan.textContent = "1";
        const plusBtn = document.createElement("button");
        plusBtn.textContent = "+";
        minusBtn.addEventListener("click", () => {
            let q = parseInt(qtySpan.textContent);
            if (q > 1) qtySpan.textContent = q - 1;
        });
        plusBtn.addEventListener("click", () => {
            let q = parseInt(qtySpan.textContent);
            qtySpan.textContent = q + 1;
        });
        qtyDiv.appendChild(minusBtn);
        qtyDiv.appendChild(qtySpan);
        qtyDiv.appendChild(plusBtn);
        div.appendChild(qtyDiv);

        // Add to Cart button
        const addBtn = document.createElement("button");
        addBtn.className = "add-to-cart-btn";
        addBtn.textContent = "Add to Cart";
        addBtn.addEventListener("click", () => {
            const qty = parseInt(qtySpan.textContent);
            cart[product.variantId] = (cart[product.variantId] || 0) + qty;
            openCart();
            renderCart();
            updateCartCount();
        });
        div.appendChild(addBtn);

        grid.appendChild(div);
    });
}

// Render default
renderProducts("Popcorn");

// Tab switching logic
document.querySelectorAll("#product-tabs .tab").forEach(tab => {
tab.addEventListener("click", () => {
document.querySelectorAll("#product-tabs .tab").forEach(t => t.classList.remove("active"));
tab.classList.add("active");
const category = tab.dataset.category;
renderProducts(category);
});
});
const cartSlideout = document.getElementById("cart-slideout");
const cartOverlay = document.getElementById("cart-overlay");
const cartItemsDiv = document.getElementById("cart-items");
const subtotalDiv = document.getElementById("subtotal");
const checkoutBtn = document.getElementById("checkout-btn");
const cartCountEl = document.getElementById("cart-count");

function openCart(){ cartSlideout.style.right="0"; cartOverlay.style.display="block"; }
function closeCart(){ cartSlideout.style.right="-100%"; cartOverlay.style.display="none"; }
cartOverlay.addEventListener("click", closeCart);

function renderCart() {
cartItemsDiv.innerHTML = "";
let subtotal = 0;

// Loop through cart items
for (const [variantId, qty] of Object.entries(cart)) {
if (qty > 0) {
const product = products.find(p => p.variantId === variantId);
subtotal += product.price * qty;

const itemDiv = document.createElement("div");
itemDiv.className = "cart-item";

const img = document.createElement("img");
img.src = product.img;

const title = document.createElement("div");
title.className = "cart-item-title";
title.textContent = product.title;

const controls = document.createElement("div");
controls.className = "cart-item-controls";

const minus = document.createElement("button");
minus.textContent = "-";

const qtySpan = document.createElement("span");
qtySpan.textContent = qty;

const plus = document.createElement("button");
plus.textContent = "+";

const trash = document.createElement("button");
trash.className = "trash-btn";
trash.textContent = "x";

minus.addEventListener("click", () => {
if (cart[variantId] > 1) {
cart[variantId]--;
renderCart();
}
});

plus.addEventListener("click", () => {
cart[variantId]++;
renderCart();
});

trash.addEventListener("click", () => {
delete cart[variantId];
renderCart();
});

controls.appendChild(minus);
controls.appendChild(qtySpan);
controls.appendChild(plus);
controls.appendChild(trash);

itemDiv.appendChild(img);
itemDiv.appendChild(title);
itemDiv.appendChild(controls);

cartItemsDiv.appendChild(itemDiv);
}
}

// Update subtotal
subtotalDiv.textContent = `Subtotal: $${subtotal.toFixed(2)}`;

// Update cart count
updateCartCount();

/* --- WHAT IF FUNDRAISER --- */
let whatIfContainer = document.getElementById("what-if-container");
if (!whatIfContainer) {
whatIfContainer = document.createElement("div");
whatIfContainer.id = "what-if-container";
whatIfContainer.style.margin = "1rem 0";
whatIfContainer.style.padding = "0.8rem 1rem";
whatIfContainer.style.background = "rgba(102,203,237,0.1)";
whatIfContainer.style.borderRadius = "10px";
whatIfContainer.style.display = "none";
whatIfContainer.style.flexDirection = "column";

const whatIfText = document.createElement("div");
whatIfText.id = "what-if-text";
whatIfText.style.fontSize = "0.95rem";
whatIfText.style.fontWeight = "500";
whatIfText.style.marginBottom = "0.5rem";

const progressBarContainer = document.createElement("div");
progressBarContainer.style.background = "#fff";
progressBarContainer.style.borderRadius = "20px";
progressBarContainer.style.height = "20px";
progressBarContainer.style.width = "100%";
progressBarContainer.style.overflow = "hidden";
progressBarContainer.style.boxShadow = "inset 0 1px 3px rgba(0,0,0,0.1)";

const whatIfBar = document.createElement("div");
whatIfBar.id = "what-if-bar";
whatIfBar.style.height = "100%";
whatIfBar.style.width = "0%";
whatIfBar.style.background = "linear-gradient(90deg,#ffdd00,#ff7a00)";
whatIfBar.style.transition = "width 0.5s ease-in-out";

progressBarContainer.appendChild(whatIfBar);
whatIfContainer.appendChild(whatIfText);
whatIfContainer.appendChild(progressBarContainer);

cartSlideout.insertBefore(whatIfContainer, checkoutBtn);
}

if (subtotal > 0 && raisedEl && goalEl) {
const contribution = subtotal * 0.5;
const currentRaised = parseFloat(raisedEl.textContent.replace(/\$|,/g, "")) || 0;
const goal = parseFloat(goalEl.textContent.replace(/\$|,/g, "")) || 1;
const whatIfTotal = currentRaised + contribution;
const whatIfPercent = Math.min((whatIfTotal / goal) * 100, 100);

document.getElementById("what-if-text").textContent =
`This order would contribute an additional ${contribution.toLocaleString("en-US", { style:"currency", currency:"USD" })} and help achieve ${whatIfPercent.toFixed(0)}% of goal!`;

document.getElementById("what-if-bar").style.width = `${whatIfPercent}%`;
whatIfContainer.style.display = "flex";
} else {
whatIfContainer.style.display = "none";
}
}

function updateCartCount() {
const totalItems = Object.values(cart).reduce((a,b)=>a+b,0);
cartCountEl.textContent = totalItems;
cartCountEl.style.display = totalItems > 0 ? "flex" : "none";
}

checkoutBtn.addEventListener("click", () => {
const items = Object.entries(cart).filter(([v, q]) => q > 0);
if (items.length === 0) {
alert("Please add at least one product.");
return;
}

// Build Shopify cart path
const cartPath = items.map(([variantId, qty]) => `${variantId}:${qty}`).join(',');

// Build full checkout URL
const checkoutUrl = new URL(`https://${shopifyStore}/cart/${cartPath}`);

// Add fundraiser params as cart attributes
Object.entries({ ...fundraiserParams, "City Pop App": "true" }).forEach(([key, value]) => {
if (value) checkoutUrl.searchParams.append(`attributes[${key}]`, value);
});

// Go to checkout
window.location.href = checkoutUrl.toString();
});

</script>

<!-- Footer -->
<footer style="background:#66cbed; padding:2rem; text-align:center; font-family:sans-serif; color:white; margin-top:2rem;">
<div style="display:flex; flex-wrap:wrap; justify-content:center; gap:1rem;">
<a href="#" onclick="openModal('accessibility')" style="color:white; text-decoration:none;">Accessibility</a>
<a href="https://citypop-fundraising.gorgias.help/en-US" target="_blank" style="color:white; text-decoration:none;">Contact Us</a>
<a href="https://citypop-fundraising.gorgias.help/en-US" target="_blank" style="color:white; text-decoration:none;">Help Center</a>
<a href="#" onclick="openModal('returns')" style="color:white; text-decoration:none;">Return & Refund Policy</a>
<a href="#" onclick="openModal('privacy')" style="color:white; text-decoration:none;">Privacy Policy</a>
<a href="#" onclick="openModal('terms')" style="color:white; text-decoration:none;">Terms of Service</a>
<a href="#" onclick="openModal('shipping')" style="color:white; text-decoration:none;">Shipping Policy</a>
</div>
</footer>

<!-- Modals -->
<div id="modal-overlay" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); z-index:999;">
<div id="modal-content" style="background:#fff; max-width:500px; margin:5% auto; padding:2rem; border-radius:8px; position:relative; font-size:1rem;">
<span onclick="closeModal()" style="position:absolute; top:10px; right:15px; cursor:pointer; font-weight:bold;">&times;</span>
<div id="modal-text">
<!-- Content gets injected here -->
</div>
</div>
</div>

<script>
const modalContent = {
accessibility: "City Pop is dedicated to making our website and all of our products accessible and user-friendly for everyone. We want all of our customers to enjoy the fun, flavor, and joy that popcorn brings‚Äîwithout barriers. If you experience difficulty viewing or navigating any content on our website, or notice a feature or functionality that you believe is not fully accessible to people with disabilities, we encourage you to reach out to us. Your feedback helps us continually improve and ensure accessibility for all. You can contact us by calling 303-335-9582 or emailing info@citypopdenver.com. Please include ‚ÄúDisabled Access‚Äù in the subject line of your email and provide a description of the specific feature you feel is not fully accessible or a suggestion for improvement. We take your feedback seriously and will carefully consider it as we continue to enhance accessibility for all City Pop fans. Thank you for helping us make our site better!",
returns: "Please inspect your order upon reception and contact us immediately if the item is defective, damaged, or if you receive the wrong item. We‚Äôll evaluate the issue and make it right as quickly as possible. Edible items are not refundable or returnable. To initiate a return, contact us at info@citypopdenver.com. Returns must be sent to 5315 Xenon Street Ste A, Arvada, CO 80002. You can always contact us with any return questions at info@citypopdenver.com.",
privacy: "This Privacy Policy describes how City Pop (the ‚ÄúSite‚Äù or ‚Äúwe‚Äù) collects, uses, and discloses your Personal Information when you visit or make a purchase. Contact: If you have questions, need more information about our privacy practices, or would like to make a complaint, please contact us by email at [info@citypopdenver.com](mailto:info@citypopdenver.com) or by mail: City Pop, 5315 Xenon Street Ste A, Arvada, CO 80002, United States. Collecting Personal Information: When you visit the Site, we collect information about your device, interactions with the Site, and details needed to process purchases. This may include device information such as browser version, IP address, time zone, cookie data, pages viewed, search terms; order information such as name, billing/shipping addresses, payment info, email, phone; and customer support information you provide when contacting us for help. Minors: The Site is not intended for individuals under 13. We do not knowingly collect data from children. If you believe a child has provided us with Personal Information, please contact us for removal. Sharing Personal Information: We share your Personal Information with service providers like Shopify to provide our services. We may also disclose info to comply with laws, respond to lawful requests, or protect our rights. Behavioral Advertising: We use your data to deliver targeted ads and communications, including tools like Google Analytics, Shopify Audiences, and advertising partners. Opt-out through provider settings or the Digital Advertising Alliance opt-out portal. Your Rights: Depending on your location, you may have rights under GDPR or CCPA, such as access, correction, deletion, or portability of your Personal Information. Contact us to exercise these rights. Cookies: We use cookies to improve browsing, store preferences, and analyze traffic. Manage or block cookies in browser settings. More info is available in Shopify‚Äôs cookie policy. Do Not Track: Our Site does not alter data collection practices in response to ‚ÄúDo Not Track‚Äù signals, as no industry standard exists. Changes: We may update this Privacy Policy to reflect operational, legal, or regulatory changes. The latest version will always be on our Site. Complaints: If you wish to make a complaint, please contact us. If unsatisfied with our response, you may lodge a complaint with your local data protection authority.",
terms: "Terms of Service. This website is operated by Downtown Snacks, LLC, dba City Pop (‚ÄúCity Pop‚Äù). The terms ‚Äúwe‚Äù, ‚Äúus‚Äù and ‚Äúour‚Äù refer to City Pop. By visiting our site or purchasing, you agree to these Terms of Service. If you do not agree, you may not use the site or purchase products. Key Terms: You must be the age of majority in your jurisdiction to use our services. Orders, fundraising, and product use must comply with all applicable laws. A breach of these Terms may result in immediate termination of services. Our store is hosted on Shopify Inc., which provides our online platform. General Conditions: We reserve the right to refuse service to anyone, at any time, for any reason. You agree not to copy, sell, resell, or exploit any portion of the website, product recipes, or fundraising model without written permission. Products, Services & Pricing: Prices for our products and services are subject to change without notice. We may modify or discontinue products or services at any time. Colors, images, and descriptions are displayed as accurately as possible, but we cannot guarantee accuracy on all devices. Refunds, returns, and non-returnable items are governed by our Refund Policy. User Conduct & Prohibited Uses: You are prohibited from using our website or services for unlawful purposes, to infringe intellectual property rights, harass others, upload malicious code, or collect personal information without consent. Violation may result in termination of services. Liability Disclaimer: City Pop does not guarantee uninterrupted or error-free use of the website. Products and services are provided ‚Äúas is‚Äù and ‚Äúas available.‚Äù We are not liable for indirect, incidental, or consequential damages except as required by law. Indemnification: You agree to indemnify and hold harmless City Pop, our affiliates, and employees against claims, damages, or expenses arising from your breach of these Terms or unlawful use of our services. Governing Law: These Terms are governed by the laws of the United States. Any disputes will be resolved under applicable U.S. law. Contact Us: Questions about these Terms? Reach out to us by email at info@citypopdenver.com or by mail at City Pop, 5315 Xenon Street Ste A, Arvada, CO 80002.",
shipping: "Thank you for choosing City Pop! We ship all orders within 5-7 business days. You will receive a tracking number once your order ships. Soft Baked Pretzels are shipped frozen via FedEx 2-day delivery. Please bring deliveries inside as soon as possible as items are perishable. Please double-check your shipping address before placing your order. Items shipped to incorrect addresses are not eligible for replacement. There is a $25 address chance fee once a package has left our fulfillment center. City Pop is not responsible for lost or stolen packages. For qualifying orders, we reserve the right to select the most economical shipping method. All deliveries use reliable couriers such as UPS, FedEx, or USPS."
};

function openModal(section) {
document.getElementById('modal-text').innerText = modalContent[section] || '';
document.getElementById('modal-overlay').style.display = 'block';
}

function closeModal() {
document.getElementById('modal-overlay').style.display = 'none';
}

// Close modal if clicking outside content
document.getElementById('modal-overlay').addEventListener('click', function(e) {
if (e.target.id === 'modal-overlay') closeModal();
});
</script>

<style>
/* Hover effect for footer links */
footer a:hover {
text-decoration: underline;
}
</style>

</body>
</html>

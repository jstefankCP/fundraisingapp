<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Shop Popcorn | City Pop Fundraising</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
</head>
<body>

<header>
  <h1>Shop Popcorn for Our Fundraiser!</h1>
</header>

<section class="fundraiser-details">
  <p><strong>Fundraising Cause:</strong> City Pop Fundraiser for Local Teams</p>
  <p><strong>Organization:</strong> City Pop Fundraising</p>
  <p class="metrics"><strong>Days Left:</strong> 12 days remaining</p>
  <p class="metrics"><strong>Amount Raised:</strong> $2,430 / $5,000 Goal</p>

  <div class="share-section">
    <p>Share this fundraiser:</p>
    <button onclick="shareLink()">Share via Link</button>
    <button onclick="shareTwitter()">Share on X</button>
    <button onclick="shareFacebook()">Share on Facebook</button>
  </div>
</section>

<!-- Shopify Collection Component -->
<div id="collection-component"></div>

<footer>
  Â© 2025 City Pop Fundraising. All rights reserved.
</footer>

<script type="text/javascript">
(function() {
  const scriptURL = 'https://sdks.shopifycdn.com/buy-button/latest/buy-button-storefront.min.js';
  if (window.ShopifyBuy) {
    if (window.ShopifyBuy.UI) {
      ShopifyBuyInit();
    } else {
      loadScript();
    }
  } else {
    loadScript();
  }

  function loadScript() {
    const script = document.createElement('script');
    script.async = true;
    script.src = scriptURL;
    (document.getElementsByTagName('head')[0] || document.body).appendChild(script);
    script.onload = ShopifyBuyInit;
  }

  function ShopifyBuyInit() {
    const client = ShopifyBuy.buildClient({
      domain: 'city-pop-fundraising.myshopify.com',
      storefrontAccessToken: 'd18a70960882c060cc472257ab67a4d3',
    });

    ShopifyBuy.UI.onReady(client).then(function(ui) {

      // Grab the fundraiser parameters from the URL
      const urlParams = new URLSearchParams(window.location.search);
      const fundraiser_id = urlParams.get('fundraiser_id');
      const organization_id = urlParams.get('organization_id');
      const user_id = urlParams.get('user_id');

      ui.createComponent('collection', {
        id: '456057717025', // Replace with your collection ID
        node: document.getElementById('collection-component'),
        moneyFormat: '%24%7B%7Bamount%7D%7D',
        options: {
          product: {
            styles: {
              product: { /* your product styling here */ },
              button: { "background-color": "#0567e8", "border-radius": "25px" }
            },
            text: { button: "Add to cart" }
          },
          modalProduct: { contents: { buttonWithQuantity: true } },
          cart: {
            startOpen: false,
            popup: false,
            styles: { button: { "background-color": "#0567e8", "border-radius": "25px" } },
            text: { total: "Subtotal", button: "Checkout" },
          }
        }
      }).then((collectionComponent) => {

        // Hook into cart open/add events to set attributes
        const cart = collectionComponent.cart;

        cart.subscribe((state) => {
          // Whenever cart updates, set attributes
          cart.updateAttributes({
            fundraiser_id: fundraiser_id,
            organization_id: organization_id,
            user_id: user_id,
            heja: true // your City Pop flag
          });
        });
      });

    });
  }
})();
</script>

<!-- Share functions -->
<script>
const shareUrl = window.location.href;

function shareLink() {
  navigator.clipboard.writeText(shareUrl);
  alert("Fundraiser link copied to clipboard!");
}

function shareTwitter() {
  window.open(`https://twitter.com/intent/tweet?text=Support%20our%20fundraiser!%20${encodeURIComponent(shareUrl)}`, '_blank');
}

function shareFacebook() {
  window.open(`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(shareUrl)}`, '_blank');
}
</script>

</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>City Pop Fundraiser</title>
<style>
  body { font-family: sans-serif; background-color: #f9f9f9; color: #333; margin:0; padding:1rem; }
  h1 { color: #0567e8; text-align:center; margin-bottom:2rem; }
  .product-grid { display:flex; flex-wrap:wrap; gap:20px; justify-content:center; }
  .product-item { background:#fff; border-radius:10px; padding:1rem; flex:1 1 250px; max-width:250px; box-shadow:0 2px 6px rgba(0,0,0,0.1); display:flex; flex-direction:column; align-items:center; }
  .product-item img { width:100%; height:auto; border-radius:10px; }
  .product-title { font-weight:600; margin:0.5rem 0; text-align:center; }
  .product-price { font-weight:bold; margin-bottom:0.5rem; color:#0567e8; }
  .nutrition-link { font-size:0.9rem; color:#66cbed; text-decoration:underline; margin-bottom:0.5rem; cursor:pointer; }
  .quantity-selector { display:flex; align-items:center; justify-content:center; margin-bottom:0.5rem; }
  .quantity-selector button { background:#0567e8; color:#fff; border:none; padding:0.2rem 0.6rem; cursor:pointer; border-radius:5px; margin:0 0.3rem; font-size:1rem; }
  .quantity-selector span { width:30px; text-align:center; font-weight:bold; }
  .add-to-cart-btn { background-color:#0567e8; color:#fff; border:none; padding:0.6rem 1.2rem; border-radius:25px; cursor:pointer; font-size:1rem; width:100%; margin-top:0.3rem; }
  .add-to-cart-btn:hover { background-color:#055dd1; }
  /* Slide out cart */
  #cart-slideout { position:fixed; top:0; right:-100%; width:300px; height:100%; background:#fff; box-shadow:-2px 0 6px rgba(0,0,0,0.2); transition:right 0.3s ease; padding:1rem; overflow-y:auto; z-index:1000; }
  #cart-slideout h2 { margin-top:0; color:#0567e8; }
  .cart-item { display:flex; justify-content:space-between; margin-bottom:0.5rem; }
  .checkout-btn { background:#0567e8; color:#fff; border:none; padding:0.6rem 1.2rem; border-radius:25px; width:100%; margin-top:1rem; cursor:pointer; }
  .checkout-btn:hover { background:#055dd1; }
  #cart-overlay { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.3); z-index:999; }
  @media(max-width:600px){ .product-grid { flex-direction:column; align-items:center; } .product-item{max-width:100%;} }
</style>
</head>
<body>

<h1>Support Our Fundraiser!</h1>

<div class="product-grid" id="product-grid"></div>

<!-- Slide-out cart -->
<div id="cart-overlay"></div>
<div id="cart-slideout">
  <h2>Your Cart</h2>
  <div id="cart-items"></div>
  <button id="checkout-btn" class="checkout-btn">Checkout</button>
</div>

<script>
const shopifyStore = "city-pop-fundraising.myshopify.com";

// Product list
const products = [
  { title: "Cheese & Caramel Mix Popcorn", variantId: "47907478077729", price: 16 },
  { title: "White Cheddar Popcorn", variantId: "47949265207585", price: 12 },
  { title: "Extra Buttery Popcorn", variantId: "47946797482273", price: 12 },
  { title: "Caramel Popcorn", variantId: "47907462676769", price: 16 },
  { title: "Kettle Popcorn", variantId: "47971562193185", price: 12 },
  { title: "Jalapeno Cheddar Popcorn", variantId: "47972348264737", price: 12 },
  { title: "Cheese Popcorn", variantId: "47907469295905", price: 12 },
  { title: "Sea Salt & Cracked Pepper Popcorn", variantId: "47941483856161", price: 12 },
  { title: "Chocolate Drizzle Popcorn", variantId: "47930741424417", price: 20 },
  { title: "Low Salt Popcorn", variantId: "47971748217121", price: 12 }
];

// Extract fundraiser params
function getFundraiserParams() {
  const params = {};
  const urlParams = new URLSearchParams(window.location.search);
  ['fundraiser_id', 'organization_id', 'user_id'].forEach(key => {
    const value = urlParams.get(key);
    if (value) params[key] = value;
  });
  return params;
}
const fundraiserParams = getFundraiserParams();

// Cart state
const cart = {};

// Render products
const grid = document.getElementById("product-grid");
products.forEach((product, index) => {
  const div = document.createElement("div");
  div.className = "product-item";

  const img = document.createElement("img");
  img.src = "https://via.placeholder.com/250x200?text=Popcorn";
  div.appendChild(img);

  const title = document.createElement("div");
  title.className = "product-title";
  title.textContent = product.title;
  div.appendChild(title);

  const price = document.createElement("div");
  price.className = "product-price";
  price.textContent = `$${product.price}`;
  div.appendChild(price);

  const nutrition = document.createElement("div");
  nutrition.className = "nutrition-link";
  nutrition.textContent = "Nutrition Info";
  nutrition.addEventListener("click", () => alert("Nutritional info placeholder"));
  div.appendChild(nutrition);

  // Quantity selector with +/-
  const qtyDiv = document.createElement("div");
  qtyDiv.className = "quantity-selector";

  const minusBtn = document.createElement("button"); minusBtn.textContent = "-";
  const qtySpan = document.createElement("span"); qtySpan.textContent = "1";
  const plusBtn = document.createElement("button"); plusBtn.textContent = "+";

  minusBtn.addEventListener("click", () => {
    let qty = parseInt(qtySpan.textContent);
    if(qty>1) qtySpan.textContent = qty-1;
  });
  plusBtn.addEventListener("click", () => {
    let qty = parseInt(qtySpan.textContent);
    qtySpan.textContent = qty+1;
  });

  qtyDiv.appendChild(minusBtn);
  qtyDiv.appendChild(qtySpan);
  qtyDiv.appendChild(plusBtn);
  div.appendChild(qtyDiv);

  // Add to cart button
  const addBtn = document.createElement("button");
  addBtn.className = "add-to-cart-btn";
  addBtn.textContent = "Add to Cart";
  addBtn.addEventListener("click", () => {
    const qty = parseInt(qtySpan.textContent);
    cart[product.variantId] = qty;
    openCart();
    renderCart();
  });
  div.appendChild(addBtn);

  grid.appendChild(div);
});

// Slide-out cart functions
const cartSlideout = document.getElementById("cart-slideout");
const cartOverlay = document.getElementById("cart-overlay");
const cartItemsDiv = document.getElementById("cart-items");
const checkoutBtn = document.getElementById("checkout-btn");

function openCart(){
  cartSlideout.style.right = "0";
  cartOverlay.style.display = "block";
}

function closeCart(){
  cartSlideout.style.right = "-100%";
  cartOverlay.style.display = "none";
}

cartOverlay.addEventListener("click", closeCart);

function renderCart(){
  cartItemsDiv.innerHTML = "";
  for(const [variantId, qty] of Object.entries(cart)){
    if(qty>0){
      const product = products.find(p=>p.variantId===variantId);
      const itemDiv = document.createElement("div");
      itemDiv.className = "cart-item";
      itemDiv.textContent = `${product.title} x${qty}`;
      cartItemsDiv.appendChild(itemDiv);
    }
  }
}

// Checkout button
checkoutBtn.addEventListener("click", () => {
  const items = Object.entries(cart).filter(([v,q])=>q>0);
  if(items.length===0){ alert("Please add at least one product."); return; }

  const checkoutUrl = new URL(`https://${shopifyStore}/cart`);
  items.forEach(([variantId, qty]) => {
    checkoutUrl.pathname += `/${variantId}:${qty}`;
  });

  // Add fundraiser attributes
  Object.entries(fundraiserParams).forEach(([key,value]) => {
    if(value) checkoutUrl.searchParams.append(`attributes[${key}]`, value);
  });

  window.location.href = checkoutUrl.toString();
});
</script>

</body>
</html>

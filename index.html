<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Shop Popcorn | City Pop Fundraising</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <header>
    <h1>Shop Popcorn for Our Fundraiser!</h1>
  </header>

  <section class="fundraiser-details">
    <p><strong>Fundraising Cause:</strong> City Pop Fundraiser for Local Teams</p>
    <p><strong>Organization:</strong> City Pop Fundraising</p>
    <p class="metrics"><strong>Days Left:</strong> 12 days remaining</p>
    <p class="metrics"><strong>Amount Raised:</strong> $2,430 / $5,000 Goal</p>

    <div class="share-section">
      <p>Share this fundraiser:</p>
      <button onclick="shareLink()">Share via Link</button>
      <button onclick="shareTwitter()">Share on X</button>
      <button onclick="shareFacebook()">Share on Facebook</button>
    </div>
  </section>

  <!-- Shopify Collection Component -->
  <div id='collection-component-1761423819822'></div>

  <footer>
    Â© 2025 City Pop Fundraising. All rights reserved.
  </footer>

  <!-- Shopify Buy Button Snippet -->
  <script type="text/javascript">
  (function () {
    var scriptURL = 'https://sdks.shopifycdn.com/buy-button/latest/buy-button-storefront.min.js';

    function loadScript() {
      var script = document.createElement('script');
      script.async = true;
      script.src = scriptURL;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(script);
      script.onload = ShopifyBuyInit;
    }

    if (window.ShopifyBuy) {
      if (window.ShopifyBuy.UI) {
        ShopifyBuyInit();
      } else {
        loadScript();
      }
    } else {
      loadScript();
    }

    // Capture URL parameters
    function getURLParameters() {
      var params = {};
      var parser = document.createElement('a');
      parser.href = window.location.href;
      var query = parser.search.substring(1);
      var vars = query.split('&');
      for (var i = 0; i < vars.length; i++) {
        var pair = vars[i].split('=');
        params[decodeURIComponent(pair[0])] = decodeURIComponent(pair[1]);
      }
      return params;
    }

    var urlParams = getURLParameters();

    function ShopifyBuyInit() {
      var client = ShopifyBuy.buildClient({
        domain: 'city-pop-fundraising.myshopify.com',
        storefrontAccessToken: 'd18a70960882c060cc472257ab67a4d3',
      });

      ShopifyBuy.UI.onReady(client).then(function (ui) {
        ui.createComponent('collection', {
          id: '456057717025',
          node: document.getElementById('collection-component-1761423819822'),
          moneyFormat: '%24%7B%7Bamount%7D%7D',
          options: {
            product: {
              styles: {
                product: { /* your style settings */ },
                button: { 
                  "background-color": "#0567e8",
                  ":hover": { "background-color": "#055dd1" },
                  ":focus": { "background-color": "#055dd1" },
                  "border-radius": "25px"
                }
              },
              buttonDestination: 'cart', // keep normal Add to Cart behavior
              text: { button: "Add to cart" }
            },
            cart: {
              styles: {
                button: { 
                  "background-color": "#0567e8",
                  ":hover": { "background-color": "#055dd1" },
                  ":focus": { "background-color": "#055dd1" },
                  "border-radius": "25px"
                }
              },
              text: { total: "Subtotal", button: "Checkout" },
              popup: false
            },
            productSet: {},
            modalProduct: {}
          }
        }).then(function(cartComponent) {
          // Wait until cart is ready
          const cartButton = document.querySelector('.shopify-buy__cart__checkout');
          if (cartButton) {
            cartButton.addEventListener('click', function(e) {
              e.preventDefault();
              client.checkout.create().then(function(checkout) {
                // Append attributes to checkout URL
                const checkoutUrl = `${checkout.webUrl}?attributes%5BCityPopApp%5D=true` +
                  `&attributes%5Bfundraiser_id%5D=${encodeURIComponent(urlParams.fundraiser_id || '')}` +
                  `&attributes%5Borganization_id%5D=${encodeURIComponent(urlParams.organization_id || '')}` +
                  `&attributes%5Buser_id%5D=${encodeURIComponent(urlParams.user_id || '')}`;
                window.location.href = checkoutUrl;
              });
            });
          }
        });
      });
    }
  })();
  </script>

  <!-- Simple share logic -->
  <script>
    const shareUrl = window.location.href;
    function shareLink() { navigator.clipboard.writeText(shareUrl); alert("Fundraiser link copied!"); }
    function shareTwitter() { window.open(`https://twitter.com/intent/tweet?text=Support our fundraiser! ${encodeURIComponent(shareUrl)}`, '_blank'); }
    function shareFacebook() { window.open(`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(shareUrl)}`, '_blank'); }
  </script>
</body>
</html>
